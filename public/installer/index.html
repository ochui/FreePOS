<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>FreePOS - Installation Wizard</title>
    <meta name="description" content="FreePOS Installation Wizard" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="shortcut icon" href="../assets/images/favicon.ico">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../assets/css/ace-fonts.css" />
    <link rel="stylesheet" href="../assets/css/ace.min.css" />
    
    <style>
        .installer-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .status-message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .status-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .progress {
            height: 20px;
            margin-bottom: 20px;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
    </style>
</head>
<body class="login-layout">
    <div class="main-container">
        <div class="installer-container">
            <div class="logo">
                <h1><i class="icon-shopping-cart"></i> FreePOS</h1>
                <h4>Installation Wizard</h4>
            </div>

            <div id="step-1" class="step active">
                <h3>Welcome to FreePOS</h3>
                <p>This wizard will guide you through the installation process.</p>
                
                <div id="status-check">
                    <h4>Checking system status...</h4>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped active" style="width: 100%"></div>
                    </div>
                </div>

                <div id="status-result" style="display: none;">
                    <div id="status-message" class="status-message"></div>
                    <div id="install-controls" style="display: none;">
                        <button id="btn-install" class="btn btn-primary btn-lg">Start Installation</button>
                    </div>
                    <div id="already-installed" style="display: none;">
                        <p><strong>FreePOS is already installed!</strong></p>
                        <p><a href="../admin/" class="btn btn-success">Go to Admin Dashboard</a></p>
                        <p><a href="../" class="btn btn-info">Go to POS</a></p>
                    </div>
                </div>
            </div>

            <div id="step-2" class="step">
                <h3>Installing FreePOS</h3>
                <div class="progress">
                    <div id="install-progress" class="progress-bar progress-bar-striped active" style="width: 0%"></div>
                </div>
                <div id="install-status">Preparing installation...</div>
            </div>

            <div id="step-3" class="step">
                <h3>Installation Complete!</h3>
                <div class="status-message status-success">
                    <strong>Congratulations!</strong> FreePOS has been successfully installed.
                </div>
                
                <h4>Default Login Credentials:</h4>
                <ul>
                    <li><strong>Admin Username:</strong> admin</li>
                    <li><strong>Password:</strong> admin</li>
                </ul>
                
                <div class="alert alert-warning">
                    <strong>Security Notice:</strong> Please change the default admin password immediately after logging in!
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <a href="../admin/" class="btn btn-success btn-lg">Go to Admin Dashboard</a>
                    <a href="../" class="btn btn-info btn-lg">Go to POS</a>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/jquery-2.0.3.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            checkInstallStatus();
            
            $('#btn-install').click(function() {
                startInstallation();
            });
        });

        function checkInstallStatus() {
            $.ajax({
                url: '../api/install/status',
                type: 'POST',
                dataType: 'json',
                success: function(response) {
                    $('#status-check').hide();
                    $('#status-result').show();
                    
                    if (response.errorCode === 'OK') {
                        if (response.data.installed) {
                            $('#status-message').addClass('status-info').html(
                                '<strong>Database found!</strong> FreePOS appears to be already installed.<br>' +
                                (response.data.version ? 'Current version: ' + response.data.version : 'Version information not available')
                            );
                            $('#already-installed').show();
                        } else {
                            $('#status-message').addClass('status-info').html(
                                '<strong>Ready to install!</strong> FreePOS is not yet installed and ready for setup.'
                            );
                            $('#install-controls').show();
                        }
                    } else {
                        $('#status-message').addClass('status-error').html(
                            '<strong>Error:</strong> ' + response.error
                        );
                    }
                },
                error: function() {
                    $('#status-check').hide();
                    $('#status-result').show();
                    $('#status-message').addClass('status-error').html(
                        '<strong>Connection Error:</strong> Unable to check installation status. Please check your database configuration.'
                    );
                }
            });
        }

        function startInstallation() {
            $('#step-1').removeClass('active');
            $('#step-2').addClass('active');
            
            updateProgress(25, 'Creating database tables...');
            
            $.ajax({
                url: '../api/install',
                type: 'POST',
                dataType: 'json',
                success: function(response) {
                    if (response.errorCode === 'OK') {
                        updateProgress(75, 'Configuring system...');
                        setTimeout(function() {
                            updateProgress(100, 'Installation complete!');
                            setTimeout(function() {
                                $('#step-2').removeClass('active');
                                $('#step-3').addClass('active');
                            }, 1000);
                        }, 1000);
                    } else {
                        updateProgress(0, 'Installation failed: ' + response.error);
                        $('#install-progress').removeClass('active').addClass('progress-bar-danger');
                    }
                },
                error: function(xhr, status, error) {
                    updateProgress(0, 'Installation failed: Connection error');
                    $('#install-progress').removeClass('active').addClass('progress-bar-danger');
                }
            });
        }

        function updateProgress(percent, message) {
            $('#install-progress').css('width', percent + '%');
            $('#install-status').text(message);
        }
    </script>
</body>
</html>